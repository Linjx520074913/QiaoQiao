# 快捷指令配置指南

## 方案 A：通知 + 后台识别

这个方案让用户立即看到"正在识别..."的反馈，然后在后台完成识别，最后显示结果通知。

---

## 📱 快捷指令步骤（推荐）

### 第 1 步：截屏
**操作**：截屏
- 选择：**拍摄屏幕截图**

### 第 2 步：显示通知
**操作**：显示通知
- 标题：`正在识别账单...`
- 正文：`请稍候，预计需要 3-8 秒`
- （可选）播放提示音：关闭

### 第 3 步：调用 App Intent
**操作**：显示消费卡片
- 账单图片：选择 **截屏**（第1步的输出）

### 第 4 步：显示结果通知
**操作**：显示通知
- 标题：选择 **显示消费卡片的输出**（第3步的结果）
- 正文：`点击查看详情`
- （可选）播放提示音：开启

---

## 🎯 预期效果

### 用户体验流程

1. **运行快捷指令**
2. **立即显示**："正在识别账单...请稍候，预计需要 3-8 秒"
3. **后台识别**（用户可以继续使用手机）
4. **识别完成后**显示结果通知："¥80.00 - 星巴克"

---

## 📋 快捷指令动作详细配置

### 动作 1：截屏
```
操作：截屏
输出：屏幕截图
```

### 动作 2：显示通知（加载提示）
```
操作：显示通知
标题：正在识别账单...
正文：请稍候，预计需要 3-8 秒
播放提示音：关闭
```

### 动作 3：显示消费卡片
```
操作：显示消费卡片
账单图片：[选择变量] 屏幕截图
输出：识别结果
```

### 动作 4：显示通知（结果）
```
操作：显示通知
标题：[选择变量] 识别结果
正文：点击查看详情
播放提示音：开启
```

---

## 🔧 可选优化

### 优化 1：添加时间戳
在第 2 步（加载提示）中添加当前时间：
```
标题：正在识别账单...
正文：请稍候，预计需要 3-8 秒
      [当前日期]
```

### 优化 2：错误处理
在第 3 步和第 4 步之间添加：
```
操作：如果
条件：识别结果 包含 "错误" 或 "失败"
则：显示通知 "识别失败，请重试"
否则：显示结果通知（第4步）
```

### 优化 3：自动复制金额
在第 4 步之后添加：
```
操作：从文本中获取
输入：识别结果
类型：货币金额

操作：复制到剪贴板
内容：[上一步的金额]
```

---

## 🚀 启动方式

### 方式 1：主屏幕图标
1. 长按快捷指令 → **详细信息**
2. 启用 **添加到主屏幕**
3. 自定义图标和名称（如"扫账单"）

### 方式 2：后台轻点
1. **设置 → 辅助功能 → 触控 → 轻点背面**
2. 选择 **轻点两下** 或 **轻点三下**
3. 选择你的快捷指令

### 方式 3：Siri 语音
直接说：**"嘿 Siri，显示消费卡片"**

---

## 📊 性能参考

- **简单账单**（文字清晰）：2-3 秒
- **普通账单**（标准格式）：4-6 秒
- **复杂账单**（手写/模糊）：7-10 秒

如果超过 10 秒，建议检查：
1. Mac 的 CPU/内存占用
2. WiFi 信号强度
3. Ollama 模型是否正常运行

---

## ❓ 常见问题

### Q1: 通知不显示怎么办？
A: 检查 **设置 → 通知 → 快捷指令**，确保通知已开启。

### Q2: 识别速度太慢怎么办？
A: 参考 `PERFORMANCE.md` 中的优化建议。

### Q3: 能否去掉"点击查看详情"？
A: 可以，删除第 4 步的"正文"即可。

### Q4: 能否自定义通知声音？
A: 可以，在第 4 步的"播放提示音"中选择自定义声音。

---

## 📝 示例截图

### 通知流程示例

1. **初始通知**
   ```
   正在识别账单...
   请稍候，预计需要 3-8 秒
   ```

2. **结果通知**（成功）
   ```
   ¥80.00 - 星巴克
   点击查看详情
   ```

3. **结果通知**（失败）
   ```
   识别失败
   网络错误，无法连接到服务器
   ```

---

## 🎨 进阶：自定义卡片样式

如果你想修改结果卡片的显示样式，可以编辑：
- `ExpenseSnippetView.swift` - 卡片 UI
- `ExpenseMessageGenerator.swift` - 消息生成逻辑

---

**祝你使用愉快！** 🎉
